<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Novi's Intelligence Report - {{ date }}</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen,Ubuntu,Cantarell,sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: #fff;
            border-radius: 18px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.12);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 44px 32px 32px 32px;
            text-align: center;
            position: relative;
        }
        .header-logo {
            height: 44px;
            vertical-align: middle;
            margin-bottom: 12px;
        }
        .header h1 {
            font-size: 2.3em;
            margin-bottom: 14px;
            font-weight: 700;
            letter-spacing: 0.02em;
        }
        .date-info {
            font-size: 1.12em;
            opacity: 0.95;
        }
        .status-badge {
            display: inline-block;
            padding: 4px 14px;
            border-radius: 14px;
            font-size: 0.93em;
            margin: 0 7px 0 0;
            font-weight: 600;
        }
        .status-success { background: #109B81; color: #fff; }
        .status-processing { background: #F590EB; color: #fff; }
        .status-failed { background: #EF4444; color: #fff; }
        .timezone-badge {
            background: #3B82F6;
            color: #fff;
            border-radius: 10px;
            padding: 2px 8px;
            margin-left: 6px;
            font-size: 0.91em;
        }
        .section {
            padding: 34px 32px;
            border-bottom: 1px solid #e9ecef;
            position: relative;
        }
        .section:last-child { border-bottom: none; }
        .section-title {
            display: flex;
            align-items: center;
            font-size: 1.45em;
            color: #2c3e50;
            margin-bottom: 22px;
            font-weight: 600;
            gap: 10px;
        }
        .section-title .emoji { font-size: 1.3em; margin-right: 10px; }
        .category-tab { font-weight: 600; font-size: 1.08em; display: inline-flex; align-items: center; gap: 6px; margin-right: 16px; }
        .category-icon { font-size: 1.22em; }
        .subsection { margin-bottom: 28px; }
        .subsection h3 {
            color: #495057;
            margin-bottom: 17px;
            font-size: 1.22em;
            border-left: 4px solid #007bff;
            padding-left: 12px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        /* News Priority Badges */
        .news-priority-badge {
            font-size: 0.88em;
            padding: 4px 13px;
            border-radius: 12px;
            font-weight: 700;
            margin-right: 8px;
            vertical-align: middle;
            letter-spacing: 0.03em;
        }
        .news-priority-breaking { background: #EF4444; color: #fff; }
        .news-priority-important { background: #F590EB; color: #fff; }
        .news-priority-general { background: #3B82F6; color: #fff; }
        /* News Items */
        .news-item {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 21px 22px;
            margin-bottom: 15px;
            border-radius: 12px;
            border-left: 4px solid #007bff;
            box-shadow: 0 2px 6px rgba(0,0,0,0.04);
            transition: transform 0.2s ease, box-shadow 0.2s;
            position: relative;
        }
        .news-item:hover {
            transform: translateY(-2px) scale(1.01);
            box-shadow: 0 6px 18px rgba(102,126,234,0.10);
        }
        .news-item h4 {
            color: #2c3e50;
            margin-bottom: 7px;
            font-size: 1.12em;
            font-weight: 600;
        }
        .news-item h4 a {
            color: #2c3e50;
            text-decoration: none;
        }
        .news-item h4 a:hover { color: #007bff; text-decoration: underline; }
        .news-item p {
            color: #6c757d;
            margin-bottom: 7px;
            line-height: 1.55;
            font-size: 1em;
        }
        .news-item .meta {
            font-size: 0.89em;
            color: #868e96;
            margin-top: 2px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .news-source-logo {
            height: 16px;
            vertical-align: middle;
            margin-right: 5px;
        }
        /* Stock Items */
        .stock-item {
            background: #fff;
            border: 1px solid #dee2e6;
            padding: 22px 20px;
            margin-bottom: 13px;
            border-radius: 12px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05);
        }
        .stock-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }
        .stock-name { font-weight: 600; color: #2c3e50; font-size: 1.1em; }
        .stock-symbol { font-size: 0.92em; color: #6c757d; }
        .stock-price {
            font-size: 1.23em;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .positive { color: #109B81; }
        .negative { color: #EF4444; }
        .neutral { color: #868e96; }
        .trend-arrow { font-size: 1.2em; margin-left: 7px; }
        .stock-metrics {
            display: flex;
            gap: 22px;
            margin-top: 7px;
            flex-wrap: wrap;
        }
        .metric { font-size: 0.97em; color: #6c757d; }
        .score-bar-wrapper {
            background: #e9ecef;
            border-radius: 8px;
            height: 20px;
            width: 120px;
            position: relative;
            display: inline-block;
            margin-left: 14px;
            vertical-align: middle;
        }
        .score-bar {
            background: #109B81;
            height: 100%;
            border-radius: 8px;
            transition: width 0.6s cubic-bezier(.4,2,.3,.1);
        }
        .score-label {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.9em;
            font-weight: 700;
            color: #333;
        }
        .pe-badge {
            font-weight:700;
            padding:2px 8px;
            border-radius:10px;
            font-size: 0.95em;
        }
        .pe-low { background: #d4edda; color: #155724; }
        .pe-medium { background: #fff3cd; color: #856404; }
        .pe-high { background: #f8d7da; color: #721c24; }
        /* Market Analysis Card */
        .market-analysis-card {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            padding: 19px;
            border-radius: 12px;
            margin-bottom: 13px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.04);
        }
        /* Mutual Fund Cards (reuse stock-item) */
        /* Job Cards */
        .job-item {
            background: linear-gradient(135deg, #e8f5e8 0%, #d4edda 100%);
            padding: 28px;
            margin-bottom: 17px;
            border-radius: 12px;
            border-left: 4px solid #28a745;
            box-shadow: 0 2px 8px rgba(40,167,69,0.06);
        }
        .job-title {
            color: #155724;
            font-size: 1.24em;
            font-weight: 700;
            margin-bottom: 14px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .relevance-meter {
            margin-left: 14px;
            display: flex;
            align-items: center;
        }
        .experience-badge {
            background: #3B82F6;
            color: #fff;
            padding: 3px 11px;
            border-radius: 12px;
            margin-left: 10px;
            font-size: 0.93em;
            font-weight: 600;
        }
        .salary-badge {
            background: #109B81;
            color: #fff;
            padding: 3px 12px;
            border-radius: 12px;
            margin-right: 13px;
            font-weight: 600;
            font-size: 1em;
        }
        .location-pin { color: #3B82F6; margin-right: 11px; }
        .job-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 10px;
            margin-bottom: 16px;
        }
        .job-detail { font-size: 0.98em; }
        .job-detail strong { color: #2c3e50; }
        .skills-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }
        .skill-tag {
            padding: 5px 12px;
            border-radius: 13px;
            font-size: 0.91em;
            font-weight: 600;
            margin-right: 6px;
            margin-bottom: 3px;
            color: #fff;
        }
        .skill-technology { background: #3B82F6; }
        .skill-bio { background: #109B81; }
        .skill-physics { background: #764ba2; }
        .skill-math { background: #ffc107; color: #212529; }
        /* SAP Section, Use Cases */
        .sap-item {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 12px;
            border-left: 4px solid #2196f3;
        }
        .use-case-item {
            background: #f8f9fa;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 10px;
            border: 1px solid #dee2e6;
        }
        .use-case-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }
        .complexity-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.89em;
            font-weight: 700;
        }
        .complexity-low { background: #d4edda; color: #155724; }
        .complexity-medium { background: #fff3cd; color: #856404; }
        .complexity-high { background: #f8d7da; color: #721c24; }
        .roi-info {
            display: flex;
            gap: 20px;
            margin-top: 12px;
            font-size: 0.97em;
            color: #6c757d;
        }
        /* Career Timeline */
        .career-timeline { margin-bottom: 27px; }
        .timeline-item {
            background: #fff;
            border: 1px solid #dee2e6;
            padding: 22px;
            margin-bottom: 14px;
            border-radius: 10px;
            border-left: 4px solid #6f42c1;
            position: relative;
        }
        .timeline-period {
            font-weight: 600;
            color: #6f42c1;
            margin-bottom: 9px;
            font-size: 1.06em;
        }
        /* Category Dots and Demand Badges for Career */
        .category-dot {
            width: 14px; height: 14px; display: inline-block; border-radius:50%; margin-right:7px;
        }
        .category-dot-technology { background:#3B82F6; }
        .category-dot-bio { background:#109B81; }
        .category-dot-physics { background:#764ba2; }
        .category-dot-math { background:#ffc107; }
        .demand-badge {
            font-weight:600; padding:2px 10px; border-radius:10px; margin-left:8px; font-size:0.97em;
        }
        .demand-veryhigh { background: #109B81; color: #fff; }
        .demand-high { background: #3B82F6; color: #fff; }
        .demand-medium { background: #ffc107; color: #212529; }
        /* Allocation Chart */
        .allocation-chart {
            display: flex;
            margin: 22px 0 8px 0;
            height: 34px;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 2px 6px rgba(0,0,0,0.09);
        }
        .allocation-segment {
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-weight: 600;
            font-size: 0.98em;
        }
        .large-cap { background: #007bff; }
        .mid-cap { background: #109B81; }
        .small-cap { background: #ffc107; color: #212529; }
        .flexi-cap { background: #764ba2; }
        /* Footer */
        .footer {
            background: #2c3e50;
            color: white;
            padding: 27px;
            text-align: center;
        }
        .footer-content { font-size: 0.98em; opacity: 0.93; }
        .generation-time {
            margin-top: 10px;
            font-size: 0.87em;
            opacity: 0.7;
        }
        /* Collapsible Sections */
        .collapsible-toggle {
            position: absolute;
            top: 20px; right: 20px;
            background: #3B82F6;
            color: #fff;
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            font-size: 1.6em;
            cursor: pointer;
            transition: background 0.2s;
        }
        .collapsible-toggle:hover { background: #007bff; }
        .collapsed { display: none; }
        /* Theme Switcher */
        .theme-switcher {
            position: absolute;
            top: 20px; left: 20px;
            background: #fff;
            color: #3B82F6;
            border: 1px solid #3B82F6;
            border-radius: 16px;
            padding: 4px 18px;
            font-weight: 600;
            font-size: 1.01em;
            cursor: pointer;
            transition: background 0.2s, color 0.2s;
        }
        .theme-switcher:hover { background: #3B82F6; color: #fff; }
        /* Responsive Design */
        @media (max-width: 600px) {
            body { padding: 7px; }
            .container { border-radius: 10px; }
            .header { padding: 24px 8px; }
            .header h1 { font-size: 1.55em; }
            .section { padding: 14px 7px; }
            .stock-metrics { flex-direction: column; gap: 8px; }
            .job-details { grid-template-columns: 1fr; }
            .allocation-chart { flex-direction: column; height: auto; }
            .allocation-segment { padding: 8px; margin-bottom: 2px; }
        }
        /* Dark Mode Support */
        @media (prefers-color-scheme: dark) {
            body { background: linear-gradient(135deg, #232946 0%, #4b416d 100%); color: #f8f9fa; }
            .container { background: #232946; color: #f8f9fa; }
            .header { background: linear-gradient(135deg, #343a40 0%, #495057 100%); color: #fff; }
            .section { background: #232946; color: #fff; }
            .news-item { background: linear-gradient(135deg, #343a40 0%, #495057 100%); color: #f8f9fa; }
            .stock-item { background: #343a40; border-color: #495057; color: #f8f9fa; }
            .job-item { background: linear-gradient(135deg, #324a40 0%, #3b5d47 100%); color: #f8f9fa; }
            .sap-item, .use-case-item { background: linear-gradient(135deg, #263c56 0%, #36557a 100%); color: #f8f9fa; }
            .timeline-item { background: #2c2c41; border-color: #495057; color: #f8f9fa; }
            .footer { background: #1b1b2f; color: #f8f9fa; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Theme Switcher Button (Mockup, non-functional for email) -->
        <button class="theme-switcher" title="Switch Theme">🌓</button>
        <!-- Header -->
        <div class="header">
            <img src="cid:novi_logo" class="header-logo" alt="Novi Logo">
            <h1>📊 Novi's Intelligence Report</h1>
            <div class="date-info">
                {{ date }} • {{ day }}
                <span class="status-badge status-{{ status|lower }}">{{ status }}</span>
                <small>
                    Generated at {{ time }}
                    <span class="timezone-badge">{{ timezone }}</span>
                </small>
            </div>
        </div>

        <!-- News Section -->
        {% if news %}
        <div class="section" id="news-section">
            <div class="section-title">
                <span class="emoji">📈</span>
                <span class="category-tab"><span class="category-icon">🌍</span>Global News</span>
                <span class="category-tab"><span class="category-icon">🇮🇳</span>IN India News</span>
                <span class="category-tab"><span class="category-icon">🏢</span>Regional News</span>
            </div>
            <!-- Collapsible Toggle (Mockup) -->
            <button class="collapsible-toggle" title="Collapse Section">−</button>
            <!-- Global News -->
            {% if news.global %}
            <div class="subsection">
                <h3><span class="category-icon">🌍</span>Global News</h3>
                {% for item in news.global %}
                <div class="news-item">
                    {% if item.priority %}
                    <span class="news-priority-badge news-priority-{{ item.priority|lower }}">
                        {{ "Breaking" if item.priority == "Breaking" else "Important" if item.priority == "Important" else "General" }}
                    </span>
                    {% endif %}
                    <h4><a href="{{ item.url }}" target="_blank">{{ item.title }}</a></h4>
                    <p>{{ item.description }}</p>
                    <div class="meta">
                        {% if item.source_logo %}
                        <img src="{{ item.source_logo }}" class="news-source-logo" alt="">
                        {% endif %}
                        Source: {{ item.source }} • {{ item.published }}
                    </div>
                </div>
                {% endfor %}
            </div>
            {% endif %}
            <!-- India News -->
            {% if news.india %}
            <div class="subsection">
                <h3><span class="category-icon">🇮🇳</span>India News</h3>
                {% for item in news.india %}
                <div class="news-item">
                    {% if item.priority %}
                    <span class="news-priority-badge news-priority-{{ item.priority|lower }}">
                        {{ "Breaking" if item.priority == "Breaking" else "Important" if item.priority == "Important" else "General" }}
                    </span>
                    {% endif %}
                    <h4><a href="{{ item.url }}" target="_blank">{{ item.title }}</a></h4>
                    <p>{{ item.description }}</p>
                    <div class="meta">
                        {% if item.source_logo %}
                        <img src="{{ item.source_logo }}" class="news-source-logo" alt="">
                        {% endif %}
                        Source: {{ item.source }} • {{ item.published }}
                    </div>
                </div>
                {% endfor %}
            </div>
            {% endif %}
            <!-- Regional News -->
            {% if news.regional %}
            <div class="subsection">
                <h3><span class="category-icon">🏢</span>Regional News (AP & Bangalore)</h3>
                {% for item in news.regional %}
                <div class="news-item">
                    {% if item.priority %}
                    <span class="news-priority-badge news-priority-{{ item.priority|lower }}">
                        {{ "Breaking" if item.priority == "Breaking" else "Important" if item.priority == "Important" else "General" }}
                    </span>
                    {% endif %}
                    <h4><a href="{{ item.url }}" target="_blank">{{ item.title }}</a></h4>
                    <p>{{ item.description }}</p>
                    <div class="meta">
                        {% if item.source_logo %}
                        <img src="{{ item.source_logo }}" class="news-source-logo" alt="">
                        {% endif %}
                        Source: {{ item.source }} • {{ item.published }}
                    </div>
                </div>
                {% endfor %}
            </div>
            {% endif %}
        </div>
        {% endif %}

        <!-- Stock Market Section -->
        {% if stocks %}
        <div class="section" id="stocks-section">
            <div class="section-title">
                <span class="emoji">📉</span>Stock Market Analysis
            </div>
            <!-- Large Cap Stocks -->
            {% if stocks.large_cap %}
            <div class="subsection">
                <h3>🏛️ Large Cap Stocks (Top {{ stocks.large_cap|length }})</h3>
                {% for stock in stocks.large_cap %}
                <div class="stock-item">
                    <div class="stock-header">
                        <div>
                            <div class="stock-name">{{ stock.name }}</div>
                            <div class="stock-symbol">({{ stock.symbol }})</div>
                        </div>
                        <div class="stock-price {{ 'positive' if stock.change > 0 else 'negative' if stock.change < 0 else 'neutral' }}">
                            ₹{{ stock.current_price }}
                            <span class="trend-arrow">
                                {% if stock.change > 0 %}↑{% elif stock.change < 0 %}↓{% else %}→{% endif %}
                            </span>
                            <div class="score-bar-wrapper">
                                <div class="score-bar" style="width: {{ stock.overall_score * 10 }}%;"></div>
                                <span class="score-label">{{ stock.overall_score }}/10</span>
                            </div>
                        </div>
                    </div>
                    <div class="stock-metrics">
                        <div class="metric">
                            Change: <span class="{{ 'positive' if stock.change > 0 else 'negative' if stock.change < 0 else 'neutral' }}">
                                {{ '+' if stock.change > 0 else '' }}{{ stock.change }} ({{ stock.change_percent }}%)
                            </span>
                        </div>
                        <div class="metric">
                            PE: <span class="pe-badge pe-{{ stock.pe_category|lower }}">{{ stock.pe_ratio }}</span>
                        </div>
                        <div class="metric">Recommendation: <strong>{{ stock.recommendation }}</strong></div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% endif %}
            <!-- Mid Cap Stocks -->
            {% if stocks.mid_cap %}
            <div class="subsection">
                <h3>🏢 Mid Cap Stocks (Top {{ stocks.mid_cap|length }})</h3>
                {% for stock in stocks.mid_cap %}
                <div class="stock-item">
                    <div class="stock-header">
                        <div>
                            <div class="stock-name">{{ stock.name }}</div>
                            <div class="stock-symbol">({{ stock.symbol }})</div>
                        </div>
                        <div class="stock-price {{ 'positive' if stock.change > 0 else 'negative' if stock.change < 0 else 'neutral' }}">
                            ₹{{ stock.current_price }}
                            <span class="trend-arrow">
                                {% if stock.change > 0 %}↑{% elif stock.change < 0 %}↓{% else %}→{% endif %}
                            </span>
                            <div class="score-bar-wrapper">
                                <div class="score-bar" style="width: {{ stock.overall_score * 10 }}%;"></div>
                                <span class="score-label">{{ stock.overall_score }}/10</span>
                            </div>
                        </div>
                    </div>
                    <div class="stock-metrics">
                        <div class="metric">
                            Change: <span class="{{ 'positive' if stock.change > 0 else 'negative' if stock.change < 0 else 'neutral' }}">
                                {{ '+' if stock.change > 0 else '' }}{{ stock.change }} ({{ stock.change_percent }}%)
                            </span>
                        </div>
                        <div class="metric">
                            PE: <span class="pe-badge pe-{{ stock.pe_category|lower }}">{{ stock.pe_ratio }}</span>
                        </div>
                        <div class="metric">Recommendation: <strong>{{ stock.recommendation }}</strong></div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% endif %}
            <!-- Small Cap Stocks -->
            {% if stocks.small_cap %}
            <div class="subsection">
                <h3>🏬 Small Cap Stocks (Top {{ stocks.small_cap|length }})</h3>
                {% for stock in stocks.small_cap %}
                <div class="stock-item">
                    <div class="stock-header">
                        <div>
                            <div class="stock-name">{{ stock.name }}</div>
                            <div class="stock-symbol">({{ stock.symbol }})</div>
                        </div>
                        <div class="stock-price {{ 'positive' if stock.change > 0 else 'negative' if stock.change < 0 else 'neutral' }}">
                            ₹{{ stock.current_price }}
                            <span class="trend-arrow">
                                {% if stock.change > 0 %}↑{% elif stock.change < 0 %}↓{% else %}→{% endif %}
                            </span>
                            <div class="score-bar-wrapper">
                                <div class="score-bar" style="width: {{ stock.overall_score * 10 }}%;"></div>
                                <span class="score-label">{{ stock.overall_score }}/10</span>
                            </div>
                        </div>
                    </div>
                    <div class="stock-metrics">
                        <div class="metric">
                            Change: <span class="{{ 'positive' if stock.change > 0 else 'negative' if stock.change < 0 else 'neutral' }}">
                                {{ '+' if stock.change > 0 else '' }}{{ stock.change }} ({{ stock.change_percent }}%)
                            </span>
                        </div>
                        <div class="metric">
                            PE: <span class="pe-badge pe-{{ stock.pe_category|lower }}">{{ stock.pe_ratio }}</span>
                        </div>
                        <div class="metric">Recommendation: <strong>{{ stock.recommendation }}</strong></div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% endif %}
            <!-- Market Analysis -->
            {% if stocks.analysis %}
            <div class="subsection">
                <h3>📊 Market Analysis</h3>
                <div class="market-analysis-card">
                    <h4>Market Sentiment: {{ stocks.analysis.sentiment }}</h4>
                    <p>{{ stocks.analysis.positive_stocks }} out of {{ stocks.analysis.total_stocks }} stocks showing positive movement</p>
                    <p><strong>Trend:</strong> {{ stocks.analysis.market_trend }}</p>
                </div>
            </div>
            {% endif %}
        </div>
        {% endif %}

        <!-- Mutual Funds Section -->
        {% if mutual_funds %}
        <div class="section" id="mutual-section">
            <div class="section-title">
                <span class="emoji">🏆</span>Mutual Fund Recommendations
            </div>
            {% for mf_type in ['large_cap', 'mid_cap', 'small_cap', 'flexi_cap'] %}
            {% if mutual_funds[mf_type] %}
            <div class="subsection">
                <h3>
                    {% if mf_type == 'large_cap' %}🏛️ Large Cap Funds (Top 2){% endif %}
                    {% if mf_type == 'mid_cap' %}🏢 Mid Cap Funds (Top 2){% endif %}
                    {% if mf_type == 'small_cap' %}🏬 Small Cap Funds (Top 2){% endif %}
                    {% if mf_type == 'flexi_cap' %}🔄 Flexi Cap Funds (Top 2){% endif %}
                </h3>
                {% for fund in mutual_funds[mf_type] %}
                <div class="stock-item">
                    <div class="stock-header">
                        <div class="stock-name">{{ fund.name }}</div>
                        <div class="stock-price positive">NAV: ₹{{ fund.nav }}</div>
                    </div>
                    <div class="stock-metrics">
                        <div class="metric">1Y Returns: <strong>{{ fund.returns_1y }}</strong></div>
                        <div class="metric">Category Rank: <strong>#{{ fund.category_rank }}</strong></div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% endif %}
            {% endfor %}
        </div>
        {% endif %}

        <!-- Investment Analysis Section -->
        {% if investment_analysis %}
        <div class="section" id="investment-section">
            <div class="section-title">
                <span class="emoji">🧮</span>Investment Analysis
            </div>
            {% if investment_analysis.allocation_strategy %}
            <div class="subsection">
                <h3>📊 Recommended 5-Year Allocation Strategy</h3>
                <div class="allocation-chart">
                    <div class="allocation-segment large-cap" style="width: {{ investment_analysis.allocation_strategy.large_cap }}%;">
                        Large Cap {{ investment_analysis.allocation_strategy.large_cap }}%
                    </div>
                    <div class="allocation-segment mid-cap" style="width: {{ investment_analysis.allocation_strategy.mid_cap }}%;">
                        Mid Cap {{ investment_analysis.allocation_strategy.mid_cap }}%
                    </div>
                    <div class="allocation-segment small-cap" style="width: {{ investment_analysis.allocation_strategy.small_cap }}%;">
                        Small Cap {{ investment_analysis.allocation_strategy.small_cap }}%
                    </div>
                    <div class="allocation-segment flexi-cap" style="width: {{ investment_analysis.allocation_strategy.flexi_cap }}%;">
                        Flexi Cap {{ investment_analysis.allocation_strategy.flexi_cap }}%
                    </div>
                </div>
            </div>
            {% endif %}
            {% if investment_analysis.market_outlook %}
            <div class="subsection">
                <h3>🔮 Market Outlook (2025-2030)</h3>
                <div class="news-item">
                    <p>{{ investment_analysis.market_outlook.summary }}</p>
                    <div style="margin-top: 15px;">
                        <strong>Key Investment Themes:</strong>
                        <div class="skills-list" style="margin-top: 8px;">
                            {% for theme in investment_analysis.market_outlook.key_themes %}
                            <span class="skill-tag skill-technology">{{ theme }}</span>
                            {% endfor %}
                        </div>
                    </div>
                    {% if investment_analysis.market_outlook.risks %}
                    <div style="margin-top: 15px;">
                        <strong>Risk Factors:</strong>
                        <ul style="margin-top: 8px; margin-left: 20px;">
                            {% for risk in investment_analysis.market_outlook.risks %}
                            <li>{{ risk }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endif %}
            {% if investment_analysis.top_picks %}
            <div class="subsection">
                <h3>🎯 Long-term Investment Opportunities</h3>
                {% for pick in investment_analysis.top_picks %}
                <div class="news-item">
                    <h4>{{ pick.sector }}</h4>
                    <p>{{ pick.reason }}</p>
                </div>
                {% endfor %}
            </div>
            {% endif %}
        </div>
        {% endif %}

        <!-- Jobs Section -->
        {% if jobs %}
        <div class="section" id="jobs-section">
            <div class="section-title">
                <span class="emoji">🎯</span>SAP Job Opportunities
            </div>
            {% for job in jobs[:10] %}
            <div class="job-item">
                <div class="job-title">
                    {{ job.title }}
                    <span class="relevance-meter">
                        <div class="score-bar-wrapper" style="width:80px;">
                            <div class="score-bar" style="width: {{ job.relevance_score * 10 }}%;"></div>
                        </div>
                        <span class="score-label">{{ job.relevance_score }}/10</span>
                    </span>
                    <span class="experience-badge">{{ job.experience_level }}</span>
                </div>
                <div class="job-details">
                    <span class="salary-badge">₹{{ job.package }}</span>
                    <span class="location-pin">📍 {{ job.location }}</span>
                    <span class="job-detail"><strong>Company:</strong> {{ job.company }}</span>
                </div>
                <div class="job-detail"><strong>Requirements:</strong> {{ job.requirements }}</div>
                <div class="skills-list">
                    {% for skill in job.skills %}
                    <span class="skill-tag skill-{{ skill.category|lower }}">{{ skill.name }}</span>
                    {% endfor %}
                </div>
                <p>{{ job.description }}</p>
                <div class="meta">
                    {% if job.source_logo %}
                    <img src="{{ job.source_logo }}" class="news-source-logo" alt="">
                    {% endif %}
                    {{ job.source }} • Posted: {{ job.posted_date }}
                </div>
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <!-- SAP Weekly Insights -->
        {% if sap %}
        <div class="section" id="sap-section">
            <div class="section-title">
                <span class="emoji">💼</span>SAP Weekly Insights
            </div>
            {% if sap.news %}
            <div class="subsection">
                <h3>📰 SAP News & Updates</h3>
                {% for news in sap.news %}
                <div class="sap-item">
                    <h4>{{ news.title }}</h4>
                    <p>{{ news.summary }}</p>
                    <div class="roi-info">
                        <div><strong>Category:</strong> {{ news.category }}</div>
                        <div><strong>Relevance:</strong> {{ news.relevance }}</div>
                        <div><strong>Impact:</strong> {{ news.impact }}</div>
                    </div>
                    <div class="meta" style="margin-top: 10px;">
                        <a href="{{ news.url }}" target="_blank">Read More</a> • {{ news.date }}
                    </div>
                </div>
                {% endfor %}
            </div>
            {% endif %}
            {% if sap.use_cases %}
            <div class="subsection">
                <h3>🤖 AI Use Cases in SAP Finance</h3>
                {% for use_case in sap.use_cases %}
                <div class="use-case-item">
                    <div class="use-case-header">
                        <h4>{{ use_case.title }}</h4>
                        <span class="complexity-badge complexity-{{ use_case.implementation_complexity|lower }}">
                            {{ use_case.implementation_complexity }} Complexity
                        </span>
                    </div>
                    <p>{{ use_case.description }}</p>
                    <div class="roi-info">
                        <div><strong>ROI Timeline:</strong> {{ use_case.roi_timeline }}</div>
                        <div><strong>Business Impact:</strong> {{ use_case.business_impact }}</div>
                        <div><strong>Best For:</strong> {{ use_case.recommended_for }}</div>
                    </div>
                    <div style="margin-top: 12px;">
                        <strong>Technical Requirements:</strong>
                        <div class="skills-list" style="margin-top: 8px;">
                            {% for req in use_case.technical_requirements %}
                            <span class="skill-tag skill-technology">{{ req }}</span>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% endif %}
            {% if sap.product_updates %}
            <div class="subsection">
                <h3>🔄 Product Updates</h3>
                {% for update in sap.product_updates %}
                <div class="sap-item">
                    <h4>{{ update.product }} ({{ update.version }})</h4>
                    <div style="margin-top: 10px;">
                        <strong>Key Features:</strong>
                        <ul style="margin-top: 8px; margin-left: 20px;">
                            {% for feature in update.key_features %}
                            <li>{{ feature }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                    <div style="margin-top: 12px;">
                        <strong>Finance Impact:</strong> {{ update.finance_impact }}
                    </div>
                </div>
                {% endfor %}
            </div>
            {% endif %}
            {% if sap.trends %}
            <div class="subsection">
                <h3>📈 SAP Market Trends</h3>
                {% for trend in sap.trends %}
                <div class="sap-item">
                    <h4>{{ trend.trend }}</h4>
                    <p>{{ trend.description }}</p>
                    <div class="roi-info">
                        <div><strong>Timeline:</strong> {{ trend.timeline }}</div>
                        <div><strong>Impact on Roles:</strong> {{ trend.impact_on_roles }}</div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% endif %}
        </div>
        {% endif %}

        <!-- Career Analysis Section -->
        {% if career %}
        <div class="section" id="career-section">
            <div class="section-title">
                <span class="emoji">🔄</span>Career Analysis & Future Opportunities
            </div>
            <!-- Future Skills -->
            {% if career.future_skills %}
            <div class="subsection">
                <h3>🚀 Future Skills by Field (2025-2040)</h3>
                {% for field, timelines in career.future_skills.items() %}
                <div class="career-timeline">
                    <h4 style="color: #6f42c1; margin-bottom: 15px;">
                        <span class="category-dot category-dot-{{ field|lower }}"></span>
                        {{ field }}
                    </h4>
                    {% for timeline, skills in timelines.items() %}
                    <div class="timeline-item">
                        <div class="timeline-period">{{ timeline }}</div>
                        <div class="skills-list">
                            {% for skill in skills %}
                            <span class="skill-tag skill-{{ skill.category|lower }}">{{ skill.name }}</span>
                            {% endfor %}
                        </div>
                        <div class="score-bar-wrapper" style="width: 100px;">
                            <div class="score-bar" style="width: {{ skill.score * 10 }}%;"></div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% endfor %}
            </div>
            {% endif %}
            <!-- Emerging Fields -->
            {% if career.emerging_fields %}
            <div class="subsection">
                <h3>🌟 Emerging Career Fields</h3>
                {% for field in career.emerging_fields %}
                <div class="use-case-item">
                    <div class="use-case-header">
                        <h4>{{ field.field }}</h4>
                        <span class="complexity-badge score-high">{{ field.growth_potential }}</span>
                    </div>
                    <div class="roi-info">
                        <div><strong>Mainstream Timeline:</strong> {{ field.time_to_mainstream }}</div>
                        <div><strong>Background Needed:</strong> {{ field.required_background }}</div>
                    </div>
                    <p style="margin-top: 10px;"><strong>Key Opportunities:</strong> {{ field.opportunities }}</p>
                </div>
                {% endfor %}
            </div>
            {% endif %}
            <!-- Market Predictions -->
            {% if career.market_predictions %}
            <div class="subsection">
                <h3>🔮 Market Predictions</h3>
                {% for period, prediction in career.market_predictions.items() %}
                <div class="timeline-item">
                    <div class="timeline-period">{{ period }}</div>
                    <div style="margin-bottom: 10px;">
                        <strong>Hot Sectors:</strong>
                        <div class="skills-list" style="margin-top: 5px;">
                            {% for sector in prediction.hot_sectors %}
                            <span class="skill-tag skill-technology" style="background: #d4edda; color: #155724;">{{ sector }}</
